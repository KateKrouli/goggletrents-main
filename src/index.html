<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <include src="header.html"></include>
  <main>
      <include src="main-block.html"></include>
      <include src="top-trends.html"></include>  
      <h1>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h1>

    <!-- –ö–Ω–æ–ø–∫–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
    <div style="margin-bottom: 16px;">
      <button id="sort-default" style="padding:6px 12px;">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
      <button id="sort-date" style="padding:6px 12px;">–ü–æ –¥–∞—Ç–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</button>
      <button id="sort-likes" style="padding:6px 12px;">–ü–æ –ª–∞–π–∫–∞–º</button>
      <button id="sort-views" style="padding:6px 12px;">–ü–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º</button>
    </div>

    <h2>–ù–æ–≤–æ—Å—Ç–∏</h2>
    <div id="news-container"></div>
 
<script>
let lastArticles = []; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏

async function loadPopular() {
  const res = await fetch('/popular');
  const queries = await res.json();

  const mosaic = document.getElementById('mosaic');
  if (mosaic) {
    mosaic.innerHTML = '';
    queries.forEach(q => {
      const tile = document.createElement('li');
      tile.className = 'top-trends__item';
      tile.textContent = q;
      tile.addEventListener('click', () => loadNews(q));
      mosaic.appendChild(tile);
    });
  }
}

async function loadNews(topic) {
  const res = await fetch(`/news?q=${encodeURIComponent(topic)}`);
  const articles = await res.json();

  // –î–ª—è —Ç–µ—Å—Ç–∞: –¥–æ–±–∞–≤–∏–º —Å–ª—É—á–∞–π–Ω—ã–µ –ª–∞–π–∫–∏ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
  articles.forEach(a => {
    if (typeof a.likes === 'undefined') a.likes = Math.floor(Math.random() * 1000);
    if (typeof a.views === 'undefined') a.views = Math.floor(Math.random() * 5000);
  });

  lastArticles = articles; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
  renderNews(articles);
}

function renderNews(articles) {
  const container = document.getElementById('news-container');
  container.innerHTML = '';

  if (!articles.length) {
    container.innerHTML = "<p>–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p>";
    return;
  }

  articles.forEach(article => {
    const item = document.createElement('div');
    item.className = 'news-item';
    item.innerHTML = `
      <h2><a href="${article.url}" target="_blank">${article.title}</a></h2>
      ${article.imageUrl ? `<img src="${article.imageUrl}" alt="${article.title}">` : ''}
      <p>${article.description || ''}</p>
      <small>–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ: ${new Date(article.publishedAt).toLocaleString()}</small>
      <div>üëç –õ–∞–π–∫–∏: ${article.likes ?? 0} | üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä—ã: ${article.views ?? 0}</div>
    `;
    container.appendChild(item);
  });
}

document.addEventListener('DOMContentLoaded', () => {
  const input = document.getElementById('search-input');
  const btn = document.getElementById('search-btn');
  if (input && btn) {
    btn.addEventListener('click', () => {
      const query = input.value.trim();
      if (query) loadNews(query);
    });
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const query = input.value.trim();
        if (query) loadNews(query);
      }
    });
  }

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  document.getElementById('sort-default').addEventListener('click', () => {
    renderNews(lastArticles);
  });

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
  document.getElementById('sort-date').addEventListener('click', () => {
    const sorted = [...lastArticles].sort((a, b) => new Date(b.publishedAt) - new Date(a.publishedAt));
    renderNews(sorted);
  });

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ª–∞–π–∫–∞–º
  document.getElementById('sort-likes').addEventListener('click', () => {
    const sorted = [...lastArticles].sort((a, b) => (b.likes ?? 0) - (a.likes ?? 0));
    renderNews(sorted);
  });

  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º
  document.getElementById('sort-views').addEventListener('click', () => {
    const sorted = [...lastArticles].sort((a, b) => (b.views ?? 0) - (a.views ?? 0));
    renderNews(sorted);
  });

  loadPopular();
  loadNews("Galatasaray");
});
</script>
  </main> 

  <include src="footer.html"></include> 

  <script src="lang.js"></script>
  <script src="main.js"></script>
</body>
</html>